# --- Prepare for Merges (Create Join Key) ---

root_id_col = 'P:Viaero Root ID'
site_col = 'Site #'

# --- Data Cleaning and Key Creation for df_quickbase ---
# Standardize the 'Site #' column in df_quickbase
if site_col in df_quickbase.columns:
    df_quickbase[site_col] = (
        df_quickbase[site_col].astype(str)
        .str.strip()
        .str.replace(r'\.0$', '', regex=True) # Removes '.0' if pandas read an int as float
        .str.zfill(4) # <--- ADD THIS PADDING TO QUICKBASE AS WELL
    )
    print("Step 2 (A): Padded 'Site #' in QuickBase file.")
else:
    print(f"Warning: Column '{site_col}' not found in df_quickbase. Using default empty string for key.")
    df_quickbase[site_col] = ""

# Ensure Root ID is also a string
if root_id_col not in df_quickbase.columns:
    print(f"Warning: Column '{root_id_col}' not found in df_quickbase. Using default empty string for key.")
    df_quickbase[root_id_col] = ""
    
df_quickbase['Join_Key'] = df_quickbase[root_id_col].astype(str) + df_quickbase[site_col].astype(str)


# --- Data Cleaning and Key Creation for df_rfds_status ---
# Re-using the padding logic, but making it robust
if site_col in df_rfds_status.columns:
    df_rfds_status[site_col] = (
        df_rfds_status[site_col].astype(str)
        .str.strip()
        .str.replace(r'\.0$', '', regex=True) # Robust cleaning
        .str.zfill(4) # This was already in your Step 2, keep it
    )
    print("Step 2 (B): Padded 'Site #' in RFDS status file.")
else:
    print(f"Warning: Column '{site_col}' not found in df_rfds_status. Using default empty string for key.")
    df_rfds_status[site_col] = ""

# Ensure Root ID is also a string
if root_id_col not in df_rfds_status.columns:
    print(f"Warning: Column '{root_id_col}' not found in df_rfds_status. Using default empty string for key.")
    df_rfds_status[root_id_col] = ""
    
df_rfds_status['Join_Key'] = df_rfds_status[root_id_col].astype(str) + df_rfds_status[site_col].astype(str)

# Remove the original "Step 2" since the padding is now above
# print("Step 2: Padded 'Site #' in RFDS status file.") 
